\documentclass[12pt]{article}

\usepackage{float, graphicx}
\usepackage[margin=2.5cm]{geometry}
\usepackage{amsmath, amsthm, amssymb}
% \usepackage{wrapfig}
% \usepackage[lined,boxed,commentsnumbered]{ algorithm2e }
\graphicspath{ { ./img/ } }
\newtheorem{definition}{Definition}

\usepackage{setspace}
\doublespacing

% Allows us to write code in the text %
\def\code#1{\texttt{#1}}

\begin{document}

\begin{titlepage}
	\begin{center}
		~\\[2.0cm]
		{\Huge Simulating Detachment of Tumor Cell Clusters}\\[1.5cm]
		{\Large HGEN 396: Human Genetics Research Project}\\[6.5cm]
		\emph{Student:}\\
		Mr. Zafarali Ahmed\\
		{\scriptsize zafarali [dot] ahmed [at] mail [dot] mcgill [dot] ca} \\[1.0cm]
		\emph{Supervisor:}\\
		Dr. Simon Gravel\\[1.0cm]
		\emph{Submission Date:}\\
		14th April 2015\\[1.0cm]
		\emph{Location:}\\
		McGill University
	\end{center}
\end{titlepage}

\begin{abstract}
Blood of patients with cancer contain Circulating Tumor Cells (CTCs). CTCs are the primary method through which metastasis can occur. Advances in capture technology find that CTCs exist in single cells as well as in clusters. While both contribute to metastasis, clusters have an elevated metastatic potential (CITATION WAS HERE). Rarity of CTCs make it difficult to study \emph{in vivo} and \emph{in vitro} studies are challenging to design. \\
However, we can use toy models to study them \emph{in silico}. This paper primarily looks at the suitability and the feasibility of the Cellular Potts Model (CPM) to achieve this. We simulate a range of cluster sizes and compare their properties. We also separate a tissue in two by applying opposing forces to the mass of cells. We conclude that the model selected is a clean and informative tool that can provide us with new insights into CTC formation.
\end{abstract}

\section{Introduction}
Cancer is the autonomous and uncontrolled growth of cells that forms a feed forward system to reinforce the tumorsâ€™ existence (CITATION WAS HERE). Cancer originates from accumulated mutations in tumor supressor genes, proto-onco genes and DNA repair genes. These mutations hinder a cell's abillity to regulate its cell cycles, causing it to divide uncontrollably. However, for cancerous cells to keep growing and overcome the limitations of efficient diffusion of nutrients, tumors have two solutions: angiogenesis and metastasis. Angiogenesis permits a tumor to grow blood vessels and bring in nutrients. Metastasis is the migration of cancer cells to other parts of the body often via the permeable blood vessels formed during angiogenesis. It is often after metastasis that cancer becomes difficult to contain and treat despite surgical resection (CITATION WAS HERE).

For the tumor cells to perform invasion - the first step in metastasis - the migrating cell must alter its surface interactions with the microenvironment: neighboring cells and the extra cellular matrix. Altered expression of cell adhesion molecules like cadherins and catenins facilitate these changes in interactions (CITATION WAS HERE). Once the escaped tumor cell enters the blood stream, it is referred to as a \emph{Circulating Tumor Cell} (CTC).

In a recent study (CITATION WAS HERE), CTC-Chip and CTC-iChip isolation of blood from patients with breast cancer, verified the existence of both single-CTCs and CTC-clusters. Despite being rare,  clusters demonstrated (i) higher metastatic potential, (ii) faster disease progression than their single celled counterparts and were found to (iii) originate directly from the tumor rather than aggregate in the blood.

The study also attributed the elevated expression of \emph{plakoblogin} to the formation of clusters. A literature review for plakoglobin reveals opposing schools of thought because its role in cancer and metastasis is not completely understood (CITATION WAS HERE).

To capture the above tumor dynamics, we attempt to use the Cellular Potts Model to simulate and investigate parameters resulting in the formation of single-CTCs and CTC-clusters.

\section{Purpose and Objectives}
Since metastasis is the \emph{point of no return} for most patients, it is necessary to build intuition of the factors that influence the production of single-CTCs versus CTC-clusters and the sizes of CTC-clusters produced. CTC-clusters have elevated metastatic potential and lethality, thus understanding how they detach from their parent tumors can lead to possible therapeutic strategies.

Our objective with this paper is to build and test the feasibility of a toy model that can easily be extended to account for the formation of both single-CTCs and CTC-clusters. This toy model can eventually be used to make theoretical predictions and direct future experimental research.

\section{Materials and Methods}
\subsection{Cellular Potts Model (CPM)}
The Cellular Potts Model (CPM) (CITATION WAS HERE) was used to simulate tissue cultures. The model is an extension of the q-Potts Model in statistical mechanics and is powerful due to its simplicity. 

We must first understand what makes the CPM a suitable tool to investigate the phenomenon of CTC formation and its behaviour. The CPM allows us to model certain dynamics that have been observed in tumor-metastasis literature. In particular, tumor cells display what is known as the migration/proliferation dichotomy or 'Go or Grow' mechanism (CITATION WAS HERE), where migration and proliferation are mutually independent and a tumor cell can change from one state to the other through a switch-like mechanism. This can be captured well by our model because it allows us to define cell types in addition to cells.

Circulating Tumor Cells are derived from the primary tumor and not by aggregation in the blood (CITATION WAS HERE). The CPM is very suitable for modelling processes which are slow such as the escape of a tumor cell from the primary tumor. The CPM would not be suitable to model aggregation of single CTCs in the blood as this is much faster process. 

We now describe the speicifics of the CPM. The Cellular Potts Model consists of a $M\times M$ lattice of \emph{spins}. For a more biological interpretation, we can consider a \emph{spin} to represent an area of \emph{cell cytoplasm}. To maintain consistency with established literature, we will continue to use the term \emph{spin}. At any location of the lattice, $(x,y)$, a spin can take on a value, $\sigma(x,y) = \{0,1,\ldots N\}$. A \emph{cell}, $\sigma$, is defined as a collection of these spins; as such, this restricts same-spin values to be clustered together in the lattice. If $\sigma(x,y) = 0$, then this region is said to be the \emph{extra cellular matrix (ECM)}. To be able to simulate different \emph{types} of cells, for example proliferating and migrating cells, we introduce $\tau(\sigma)$, which returns the \emph{type} of the cell $\sigma$. Two cells can be seen in Figure \ref{basic}.

For each position on the lattice, we define a \emph{Hamiltonian}, $H$, as follows:
\begin{equation}
	H = H_{surface} + H_{area} + H_{gradients}
	\label{hamiltonian}
\end{equation}

\begin{itemize}
	\item $H_{surface}$ characterizes the surface tension between a cell, $\sigma$, and its neighbours, $\sigma'$.
	\item $H_{area}$ captures the dynamics of cells being restricted to a certain size due to limitations of diffusion and cell machinery. 
	\item $H_{gradients}$ captures any external forces applied to cells due to chemical potentials and other pertubations.
\end{itemize}

The simulation then proceeds via a Monte Carlo method to flip spins in the lattice in an attempt to grow and move cells. Cells will move to minimize the Hamiltonian (Equation \ref{hamiltonian}).

\subsection{Hamiltonian Equations}
Cells experience surface tensions when they interact with their environment. This effect is captured by the following Hamiltonian function:

\begin{equation}
	H_{surface} (x,y) = \sum_{\sigma' \in \text{neighbours}~\sigma} J(\tau(\sigma), \tau(\sigma'))(1-\delta(\sigma, \sigma'))
\end{equation}

$J(\tau_1, \tau_2)=J(\tau_2, \tau_1)$ is the cell-interaction function that returns the surface tension between two cell types, $\tau_1$ and $\tau_2$, and $\delta$ is the Kronecker delta function, $\delta(x,y)=\{1:~\text{if }x=y;~0:~\text{otherwise}\}$. The Kronecker delta function prevents us from considering two lattice positions of the same spin to have a surface tension since these two spins are part of the same cell.

Cells cannot grow indefinitely. If cells are too big, they cannot efficiently diffuse nutrients and shuttle machinery within their cell boundaries. This effect can be captured by the following Hamiltonian:

\begin{equation}
	H_{area} = \sum_{\text{all spins }\sigma} (a_{current}(\sigma)-a_{target})^2 \cdot \theta(a_{target}(\sigma))
	\label{H_area}
\end{equation}

Here $a_{current}(\sigma)$ and $a_{target}(\sigma)$ are functions that return the current and target area of the cell respectively, and $\theta(x)=\{0:~\text{if}~x\leq 0;~1:~\text{if}~x>0\}$ (Here $\theta(x)$ works to prevent us from considering negative target areas. This is essential because we define $a_{target}(\sigma_{ECM}) < 0$ when implementing the model).

Finally, we would like to add perturbations to our model. For example, we would like to simulate an oxygen gradient towards a blood vessel which would make it energetically favorable for cells to move away from the main tissue and toward the blood vessel. This effect can be captured with the following Hamiltonian:
\begin{equation}
	H_{gradients}(x,y) = V(x,y)
\end{equation}
Where $V(x,y)$ is some potential that we can change to simulate a variety of different effects.

\subsection{Monte Carlo Metropolis Algorithm}
Each \emph{spin copy attempt} of our simulation follows the algorithm outlined below (CITATION WAS HERE):

\begin{enumerate}
  \item Choose a lattice site at random $(x,y)$ with a spin $\sigma_{select}$
  \item Pick a trial spin $\sigma_{trial}$ from the neighbors around $(x,y)$
  \item Calculate $H_{initial}$ using $\sigma_{select}$
  \item Calculate $H_{final}$ using $\sigma_{trial}$
  \item Calcualte energy change, $\Delta H = H_{final} - H_{intial}$
  \item{ Change $\sigma_{select}$ to $\sigma_{trial}$ with the probability:
  \begin{equation}
 		P(\text{Spin Copy Attempt Successful}) =
  	\begin{cases}
   		1 & \text{if } \Delta H \leq 0 \\
   		\exp{(-\frac{\Delta H}{T})}       & \text{if } \Delta H > 0
  	\end{cases}
  	\label{p_attempt_success}
	\end{equation}
}
\end{enumerate}

Here the temperature, $T$, accounts for thermal fluctuations and adds a stochastic element to our algorithm. This allows for the case where an unfavourable spin copy attempt will be successful if it obtains some energy from the environment in the form of a 'thermal kick'. The higher $T$ is, the more likely an unfavorable spin copy attempt is successful.

\begin{definition}[Monte Carlo Time Step (MCS)] One Monte Carlo Time Step is $M^2$ spin copy attempts, where $M$ is the size of the lattice.
\end{definition}

\subsection{Implementation and Parameters}
The model is implemented in the Python programming language and graphics are generated using Matplotlib (CITATION WAS HERE). The parameters for all simulations are mentioned.

Performance characteristics were measured on an Apple MacBook Pro (mid-2013) running Mac OS X Yosemite ($10.10$) with $2.5$GHz Intel Core i$5$ Processor and $4$GB of $1600$MHz RAM.

All code can be found on \code{http://www.github.com/zafarali/hgen-396/} under \emph{Cellular Potts Model}.

\subsection{Simulation and Experimental Setup}
% How were the experiments set up and methodology behind it%
The main focus of the project is to ensure that our model can make realistic predictions. Keeping this in mind, experiments were set up to test the feasability of the model and to see if trivial cases conform to \emph{in vivo} observations. 

We first determine the performance of our model to check if it completes in reasonable time frames and will allow us to run larger and longer experiments in the future. We ran the CPM for sizes $M\in\{1, \ldots , 40\}$ with $N=\text{floor}(\frac{M^2}{25})$ cells for $t=500$MCS to simulate the worst case scenario of using every possible lattice position (parameters: $a_{target}(\sigma(1))=25$ and $J(1,1)=1, J(1,0)=5$). We take averages over three runs using the \code{\%timeit} function available in iPython.

To validate our algorithm, we run multiple single-spin cells to determine \emph{death frequency}. A lattice was set up with $a_{start}(\sigma)=1$ and results are taken from $273$ simulations. We run this experiment for $250$MCS to give cells time to expand (parameters: $a_{target}(\sigma(1))=20$ and $J(1,1)=1, J(1,0)=5$). From this data, \emph{death frequency} is measured and we can determine if cells grow to their $a_{target}$.



\pagebreak
\section{Tables and Figures}

% \begin{table}[H]
% 	\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|}
% 	\hline
% 	k                                         & 1     & 2     & 3     & 4     & 5     & 6     & 7     & 8     & 9     & 10    \\ \hline
% 	Mean Velocity $(\frac{10^-3}{MCS})$ & 21.49 & 23.88 & 25.80 & 25.50 & 24.70 & 25.38 & 25.22 & 24.08 & 25.06 & 25.01 \\ \hline
% 	Variance in velocity 							& 22.89		&	7.44	&	7.24	&	0.91	&	1.47	&	0.47	&	0.72	&	1.07	&	1.07	&	1.70 \\ \hline
% 	Splitting Frequency              & N/A   & 0.2   & 0.06  & 0.02  & 0.03  & 0.00  & 0.01  & 0.01  & 0.02  & 0.01  \\ \hline
% 	Survival             & 1.00  & 1.00  & 1.00  & 1.00  & 1.00  & 1.00  & 1.00  & 1.00  & 1.00  & 1.00 \\ \hline
% 	\end{tabular}
% 	\caption{Results from running $k$-CTCs experiencing a constant force for successive $k$.}
% 	\label{racestats}
% \end{table}

\pagebreak


% \begin{figure}[H]
% 	\centering
% 	\includegraphics[scale=0.5]{img/forceapplied}
% 	\caption{Representation of the force applied at each y-position of the lattice. A positive force represents and acceleration in the positive $y$ direction.}
% 	\label{forceapplied}
% \end{figure}



\newpage
\bibliographystyle{abbrv}
% \bibliography{396}


\end{document}